
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Interactive Room Map</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <style>
    html, body {
      margin: 0; padding: 0;
      height: 100%; width: 100%;
      overflow: hidden;
      font-family: sans-serif;
    }
    #toolbar {
      position: fixed;
      top: 10px; left: 10px;
      background: #fff;
      border: 1px solid #ccc;
      border-radius: 6px;
      padding: 10px;
      z-index: 10;
    }
    #room {
      width: 100%; height: 100%;
      position: relative;
      background: url('floorplan.jpg') no-repeat center center;
      background-size: contain;
    }
    .label {
      position: absolute;
      background: rgba(255,255,255,0.8);
      border: 1px solid #999;
      border-radius: 4px;
      padding: 2px 6px;
      font-size: 12px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 90px;
      transition: max-width 0.3s ease;
      cursor: move;
    }
    .label:hover {
      max-width: 200px;
    }
    .shape {
      position: absolute;
      cursor: move;
    }
    .shape.circle {
      width: 50px; height: 50px;
      border-radius: 50%;
      background: rgba(0, 128, 255, 0.4);
      border: 2px solid #0066cc;
    }
    .shape.rect {
      width: 60px; height: 40px;
      background: rgba(0, 200, 100, 0.4);
      border: 2px solid #009966;
    }
    .icon {
      font-size: 30px;
      color: #333;
    }
    .delete-btn {
      position: absolute;
      top: -10px; right: -10px;
      background: red;
      color: white;
      border: none;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      cursor: pointer;
      font-size: 12px;
    }
  </style>
</head>
<body>
  <div id="toolbar">
    <button onclick="addLabel()">Add Label</button>
    <button onclick="addRect()">Add Rectangle</button>
    <button onclick="addCircle()">Add Circle</button>
    <select id="iconPicker">
      <option value="">Add Icon</option>
      <option value="fa-chair">Chair</option>
      <option value="fa-table">Table</option>
      <option value="fa-user">Person</option>
    </select>
    <input type="file" id="iconUpload" accept="image/*" />
    <button onclick="saveMap()">Save</button>
    <input type="file" id="loadFile" onchange="loadMap(this)">
  </div>
  <div id="room"></div>

  <script>
    const room = document.getElementById("room");

    function makeDraggable(el) {
      let offsetX, offsetY, dragging = false;
      el.addEventListener("mousedown", e => {
        dragging = true;
        offsetX = e.offsetX;
        offsetY = e.offsetY;
      });
      document.addEventListener("mousemove", e => {
        if (!dragging) return;
        el.style.left = (e.pageX - offsetX) + "px";
        el.style.top = (e.pageY - offsetY) + "px";
      });
      document.addEventListener("mouseup", () => dragging = false);
    }

    function createDeleteButton(el) {
      const btn = document.createElement("button");
      btn.className = "delete-btn";
      btn.textContent = "×";
      btn.onclick = () => el.remove();
      el.appendChild(btn);
    }

    function addLabel(x = 100, y = 100, text = "Hover to expand") {
      const el = document.createElement("div");
      el.className = "label";
      el.contentEditable = true;
      el.style.left = x + "px";
      el.style.top = y + "px";
      el.textContent = text;
      createDeleteButton(el);
      room.appendChild(el);
      makeDraggable(el);
    }

    function addRect(x = 100, y = 150) {
      const el = document.createElement("div");
      el.className = "shape rect";
      el.style.left = x + "px";
      el.style.top = y + "px";
      createDeleteButton(el);
      room.appendChild(el);
      makeDraggable(el);
    }

    function addCircle(x = 160, y = 150) {
      const el = document.createElement("div");
      el.className = "shape circle";
      el.style.left = x + "px";
      el.style.top = y + "px";
      createDeleteButton(el);
      room.appendChild(el);
      makeDraggable(el);
    }

    document.getElementById("iconPicker").addEventListener("change", function() {
      if (!this.value) return;
      const el = document.createElement("i");
      el.className = "fa-solid icon " + this.value;
      el.style.position = "absolute";
      el.style.left = "200px";
      el.style.top = "200px";
      createDeleteButton(el);
      room.appendChild(el);
      makeDraggable(el);
      this.selectedIndex = 0;
    });

    document.getElementById("iconUpload").addEventListener("change", function(e) {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function(evt) {
        const img = document.createElement("img");
        img.src = evt.target.result;
        img.style.position = "absolute";
        img.style.left = "250px";
        img.style.top = "250px";
        img.style.width = "40px";
        img.style.height = "40px";
        createDeleteButton(img);
        room.appendChild(img);
        makeDraggable(img);
      };
      reader.readAsDataURL(file);
    });

    function saveMap() {
      const items = Array.from(room.children).map(el => {
        return {
          tag: el.tagName.toLowerCase(),
          class: el.className,
          content: el.textContent.replace("×", "").trim(),
          src: el.src || null,
          left: el.style.left,
          top: el.style.top
        };
      });
      const blob = new Blob([JSON.stringify(items)], {type: "application/json"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "map-layout.json";
      a.click();
    }

    function loadMap(input) {
      const file = input.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function(evt) {
        room.innerHTML = "";
        const items = JSON.parse(evt.target.result);
        items.forEach(item => {
          let el;
          if (item.class.includes("label")) {
            el = document.createElement("div");
            el.className = item.class;
            el.contentEditable = true;
            el.textContent = item.content;
          } else if (item.class.includes("icon")) {
            el = document.createElement("i");
            el.className = item.class;
            el.textContent = "";
          } else if (item.tag === "img") {
            el = document.createElement("img");
            el.src = item.src;
            el.style.width = "40px";
            el.style.height = "40px";
          } else {
            el = document.createElement("div");
            el.className = item.class;
          }
          el.style.left = item.left;
          el.style.top = item.top;
          el.style.position = "absolute";
          createDeleteButton(el);
          room.appendChild(el);
          makeDraggable(el);
        });
      };
      reader.readAsText(file);
    }

    room.addEventListener("dblclick", e => {
      addLabel(e.offsetX, e.offsetY);
    });
  </script>
</body>
</html>
